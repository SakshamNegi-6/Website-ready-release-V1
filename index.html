<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Cyber Security Quiz</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Orbitron:wght@700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
<style>
:root {
  --primary-dark:#0d1b2a;
  --primary-light:#111827;
  --accent-glow:#00aaff;
  --accent-alt:#41e0c3;
  --accent-gold:#ffd700;
  --accent-silver:#c0c0c0;
  --accent-bronze:#cd7f32;
  --text-primary:#e0e1dd;
  --text-secondary:#a8b2d1;
  --glow-correct:#41e0c3;
  --glow-incorrect:#ff4d79;
}
* { box-sizing:border-box; }
html, body { height:100%; }
body {
  margin:0;
  padding:20px;
  font-family:'Poppins',sans-serif;
  background:var(--primary-dark);
  color:var(--text-primary);
  display:flex;
  align-items:center;
  justify-content:center;
  min-height:100vh;
}
.container {
  width:94%;
  max-width:980px;
  background:var(--primary-light);
  padding:26px;
  border-radius:14px;
  box-shadow:0 8px 32px rgba(0,0,0,0.45);
}
.logo {
  width:84px;height:84px;margin:0 auto 10px;border-radius:12px;
  background:linear-gradient(135deg,var(--accent-glow),var(--accent-alt));
  display:flex;align-items:center;justify-content:center;
  font-family:'Orbitron',sans-serif;color:#071426;font-weight:700;font-size:26px;
}
h1 {font-family:'Orbitron',sans-serif;color:var(--accent-gold);text-align:center;margin:6px 0}
h2 {font-size:16px;color:var(--text-secondary);text-align:center;margin:6px 0 16px 0}
.actions {display:flex;justify-content:center;gap:12px;margin-top:14px}
button {cursor:pointer;border-radius:10px;border:1px solid rgba(255,255,255,0.06);padding:10px 14px;background:transparent;color:var(--text-primary);font-weight:600;transition: background-color 0.2s, color 0.2s;}
button:disabled {cursor:not-allowed;opacity:0.5;}
.main-btn {background:var(--accent-gold);color:#111;border:none;padding:10px 18px}
.secondary-btn {border:1px solid var(--accent-alt);color:var(--accent-alt);background:transparent;padding:9px 14px}
.secondary-btn:hover:not(:disabled) {background-color:var(--accent-alt);color:var(--primary-dark);}
.hidden {display:none}
.leaderboard {margin-top:18px;padding-top:12px;border-top:1px solid rgba(255,255,255,0.04);text-align:left}
.leaderboard-item {display:flex;justify-content:space-between;padding:8px 12px;border-bottom:1px solid rgba(255,255,255,0.03)}
.medal-gold {color:var(--accent-gold);font-weight:700}
.medal-silver {color:var(--accent-silver);font-weight:700}
.medal-bronze {color:var(--accent-bronze);font-weight:700}

#quiz-area,#results-area {display:none}
.question {font-size:20px;font-weight:700;margin:12px 0}
.options {display:flex;flex-direction:column;gap:10px;margin-top:14px}
.option-btn {padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.02);text-align:left}
.option-btn:hover:not(:disabled) {background:rgba(255,255,255,0.04)}
.option-btn.correct {background:rgba(65,224,195,0.12);border-color:var(--glow-correct);color:var(--text-primary);}
.option-btn.incorrect {background:rgba(255,77,121,0.12);border-color:var(--glow-incorrect);color:var(--text-primary);}
#progress-wrap {width:100%;background:rgba(0,0,0,0.2);height:10px;border-radius:8px;margin-top:12px}
#progress-bar {height:100%;width:0%;background:linear-gradient(90deg,var(--accent-glow),var(--accent-alt));border-radius:8px;transition:width .25s}
#timer-display {font-family:'Orbitron',sans-serif;color:var(--accent-alt);text-align:center;margin-top:10px;height:20px;}

.modal {position:fixed;left:0;top:0;width:100%;height:100%;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.65);z-index:1000}
.modal-box {background:var(--primary-light);padding:22px;border-radius:12px;max-width:700px;width:92%;color:var(--text-primary)}
.modal-title {font-family:'Orbitron',sans-serif;color:var(--accent-glow);font-size:20px;margin-bottom:12px;text-align:center}

.small-note {font-size:13px;color:var(--text-secondary)}
.footer {display:flex;justify-content:center;gap:12px;margin-top:18px}
@media(max-width:600px){.container{padding:16px}.logo{width:64px;height:64px;font-size:20px}.question{font-size:18px}}
</style>
</head>
<body>
  <div id="welcome" class="container">
    <div class="logo">CSQ</div>
    <h1>Cyber Security Quiz</h1>
    <h2 class="small-note">Play, learn, and protect your digital life.</h2>
    <div class="actions">
      <button id="start" class="main-btn">Start Quiz</button>
      <button id="settings" class="secondary-btn">Settings</button>
      <button id="about" class="secondary-btn">About</button>
    </div>
    <div class="leaderboard">
      <h3>Top 5</h3>
      <div id="leaderboard-list"></div>
    </div>
  </div>

  <div id="quiz-area" class="container">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <h2 id="round-title" class="small-note" style="margin:0;"></h2>
      <button id="hint" class="secondary-btn">Hint (1)</button>
    </div>
    <div class="question" id="question-text"></div>
    <div id="options" class="options"></div>
    <div id="progress-wrap"><div id="progress-bar"></div></div>
    <div id="timer-display"></div>
    <div class="footer">
      <button id="next" class="main-btn hidden">Next</button>
      <button id="quit" class="secondary-btn">Quit</button>
    </div>
  </div>

  <div id="results-area" class="container">
    <h2>Results</h2>
    <div id="score-area"></div>
    <p id="position-msg" class="small-note"></p>
    <div id="results-leaderboard"></div>
    <div class="footer">
      <button id="review" class="secondary-btn">Review</button>
      <button id="home" class="main-btn">Go Home</button>
    </div>
  </div>

  <div id="hard-modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="hard-modal-title">
    <div class="modal-box">
      <div id="hard-modal-title" class="modal-title">⚡ Special Round: Hard Mode ⚡</div>
      <div id="hard-instructions"></div>
      <div style="text-align:center;margin-top:14px">
        <button id="start-hard" class="main-btn">Start Round</button>
      </div>
    </div>
  </div>

  <div id="generic-modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="generic-modal-title">
    <div class="modal-box">
        <div id="generic-modal-title" class="modal-title"></div>
        <div id="generic-content"></div>
        <div style="text-align:center;margin-top:12px">
            <button id="close-generic" class="main-btn">Close</button>
        </div>
    </div>
  </div>

  <audio id="snd-correct" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_f8b4c31f43.mp3?filename=correct-2-46134.mp3" preload="auto"></audio>
  <audio id="snd-wrong"   src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_43f00a76e0.mp3?filename=error-126627.mp3" preload="auto"></audio>

<script>
'use strict';
// =================================================================
// CONFIGURATION & QUESTION BANKS
// =================================================================
let hardModeTimer = Number(localStorage.getItem('hardModeTimer') || 15);
const QUIZ_LENGTH = 20; // Number of normal questions to start with

const MASTER_NORMAL = [
  { q:"What is phishing?", opts:["An attack that tricks people into revealing information","A tool for encrypting emails","A method to repair software","A firewall setting"], correct:0 },
  { q:"Strong passwords should include what?", opts:["Only letters","Only numbers","A mix of letters, numbers, and symbols","Just your name"], correct:2 },
  { q:"Which of these is a type of malware?", opts:["Trojan horse","Firewall","Two-factor authentication","VPN"], correct:0 },
  { q:"What does HTTPS in a URL mean?", opts:["The connection is secure and encrypted","The website is fast","The site has high-definition text","The site is a host"], correct:0 },
  { q:"What is the safest way to browse on public Wi-Fi?", opts:["Using a VPN","Turning off your firewall","Sharing files directly","Logging into sensitive accounts"], correct:0 },
  { q:"What should you do with a suspicious email link?", opts:["Click it to see where it goes","Report it or delete it","Forward it to all your friends","Reply to the sender"], correct:1 },
  { q:"What is two-factor authentication (2FA)?", opts:["Using one very long password","A double-length password","An extra security step, like a code from your phone","A guest login mode"], correct:2 },
  { q:"What software protects your computer from viruses?", opts:["Antivirus software","A malware app","A photo editor","A video player"], correct:0 },
  { q:"Which is an example of social engineering?", opts:["Someone calling you pretending to be tech support","A virus hidden in a program's code","A software update patch","A hardware malfunction"], correct:0 },
  { q:"What is the best practice for software updates?", opts:["Update them regularly","Never update them","Disable all update notifications","Only update them once a year"], correct:0 },
  { q:"Ransomware is a type of malware that...", opts:["Locks your files and demands payment to unlock them","Sends spam emails from your account","Improves your computer's speed","Automatically backs up your data"], correct:0 },
  { q:"A password manager is a tool that helps you...", opts:["Securely store and generate strong, unique passwords","Share your passwords with friends easily","Bypass website security","Avoid using antivirus software"], correct:0 },
  { q:"What is a VPN (Virtual Private Network) mainly used for?", opts:["Encrypting your internet connection for privacy","Making your games run faster","Getting free cloud storage","Blocking all text messages"], correct:0 },
  { q:"How can you identify a secure website?", opts:["It has a padlock icon and starts with HTTPS","It has bright colors and animations","It has many advertisements","It has a very long URL"], correct:0 },
  { q:"What is the main function of a firewall?", opts:["To block unauthorized network access","To increase your internet speed","To store your important files","To repair your computer's hardware"], correct:0 },
  { q:"You should avoid using public computers for...", opts:["Online banking","Reading the news","Watching videos","Checking the weather"], correct:0 },
  { q:"Spyware is a type of malware designed to...", opts:["Secretly monitor your activity and steal information","Protect your personal files","Improve your computer's graphics","Clean up your computer's memory"], correct:0 },
  { q:"What is a digital footprint?", opts:["The trail of data you leave behind online","A log file from an antivirus scan","Your monthly internet bill","A backup of your phone's data"], correct:0 },
  { q:"What is a brute-force attack?", opts:["Trying many passwords to guess the correct one","Using a firewall to block traffic","Encrypting your hard drive","Physically breaking a computer"], correct:0 },
  { q:"The safest place to download apps for your phone is...", opts:["The official app store (e.g., Google Play, Apple App Store)","A link sent to you by a stranger","A pop-up advertisement","An unofficial third-party website"], correct:0 }
];

const MASTER_HARD_MODE = [
  { q:"A 'Zero-Day' vulnerability is a security flaw that is...", opts:["Patched","Found only in mobile apps","Known for a long time","Unknown to the vendor and actively exploited"], correct:3, type:"hard", explanation:"A zero-day is a flaw the software maker is unaware of, making it highly dangerous." },
  { q:"What is 'SQL injection'?", opts:["A database attack using malicious SQL code","A secure login method","An encryption technique","An antivirus feature"], correct:0, type:"hard", explanation:"SQL injection inserts malicious SQL into queries to manipulate a database." },
  { q:"What is 'Smishing'?", opts:["A type of computer virus","A phishing scam conducted via SMS/text message","A secure messaging app","A new social media platform"], correct:1, type:"hard", explanation:"Smishing is a portmanteau of 'SMS' and 'phishing'." },
  { q:"What is 'fileless malware'?", opts:["Malware that runs in memory without writing files to disk","Malware that only affects image files","A type of safe software","A cloud storage solution"], correct:0, type:"hard", explanation:"Fileless malware is hard to detect because it lives in RAM and leaves no files on the disk." },
  { q:"The principle of 'least privilege' in cybersecurity means...", opts:["Users should only have access to what they need","Using the weakest possible passwords","Giving everyone administrator access","Disabling the firewall"], correct:0, type:"hard", explanation:"This principle minimizes potential damage from a compromised account." },
  { q:"What is a 'man-in-the-middle' attack?", opts:["An attack where a proxy is used for safety","An attacker secretly intercepts communication between two parties","A type of advanced firewall","A secure messaging protocol"], correct:1, type:"hard", explanation:"The attacker can eavesdrop or alter communications between the two victims." }
];

// =================================================================
// STATE MANAGEMENT
// =================================================================
const state = {
    quizData: [],
    currentQuestion: 0,
    score: 0,
    userAnswers: [],
    leaderboard: JSON.parse(localStorage.getItem('leaderboard') || '[]'),
    hardModeTriggers: [],
    hardModeActive: false,
    hintUsed: false,
    timerId: null
};

// =================================================================
// CORE QUIZ LOGIC
// =================================================================
function initializeQuiz() {
    state.quizData = shuffleArray(MASTER_NORMAL).slice(0, QUIZ_LENGTH);
    state.currentQuestion = 0;
    state.score = 0;
    state.userAnswers = [];
    state.hardModeActive = false;
    state.hintUsed = false;
    clearTimer();

    // Set dynamic hard mode triggers based on quiz length
    const firstTrigger = Math.floor(QUIZ_LENGTH * 0.25);
    const secondTrigger = Math.floor(QUIZ_LENGTH * 0.75);
    state.hardModeTriggers = [firstTrigger, secondTrigger].filter((v, i, a) => a.indexOf(v) === i); // Ensure unique triggers

    document.getElementById('hint').disabled = false;
    renderLeaderboard();
    showQuestion();
}

function showQuestion() {
    clearTimer();
    document.getElementById('timer-display').textContent = "";

    // Check if it's time to trigger a hard mode round
    if (state.hardModeTriggers.includes(state.currentQuestion)) {
        const triggerIndex = state.hardModeTriggers.indexOf(state.currentQuestion);
        state.hardModeTriggers.splice(triggerIndex, 1); // Use trigger only once
        insertHardModeRound();
        showHardModal();
        return; // Pause quiz until user starts hard round
    }

    const q = state.quizData[state.currentQuestion];
    document.getElementById('round-title').textContent = `Question ${state.currentQuestion + 1} of ${state.quizData.length}`;
    document.getElementById('question-text').textContent = q.q;

    const optsDiv = document.getElementById('options');
    optsDiv.innerHTML = '';

    const optObjs = q.opts.map((text, idx) => ({ text, origIdx: idx }));
    shuffleArray(optObjs).forEach(optObj => {
        const btn = document.createElement('button');
        btn.className = 'option-btn';
        btn.textContent = optObj.text;
        btn.dataset.orig = optObj.origIdx;
        btn.onclick = () => selectAnswer(btn, optObj.origIdx, q.correct);
        optsDiv.appendChild(btn);
    });

    document.getElementById('next').classList.add('hidden');
    updateProgressBar();
    if (state.hardModeActive) {
        startHardTimer();
    }
}

function selectAnswer(clickedButton, chosenOrigIdx, correctOrigIdx) {
    clearTimer();
    const q = state.quizData[state.currentQuestion];
    const isCorrect = chosenOrigIdx === correctOrigIdx;
    const isHard = q.type === 'hard';

    // Disable all option buttons and find the correct one
    const btns = Array.from(document.querySelectorAll('#options button'));
    let correctButton = null;
    btns.forEach(b => {
        b.disabled = true;
        if (Number(b.dataset.orig) === correctOrigIdx) {
            correctButton = b;
        }
    });

    // Apply styles
    if (correctButton) correctButton.classList.add('correct');
    if (!isCorrect) clickedButton.classList.add('incorrect');
    
    // Update score
    if (isCorrect) {
        state.score += isHard ? 2 : 1;
        playSound('snd-correct');
    } else {
        if (isHard) state.score = Math.max(0, state.score - 1);
        playSound('snd-wrong');
    }

    // Save answer for review
    state.userAnswers[state.currentQuestion] = {
        question: q.q, options: q.opts, chosen: chosenOrigIdx,
        correct: correctOrigIdx, explanation: q.explanation
    };

    document.getElementById('next').classList.remove('hidden');
}

function nextQuestion() {
    state.currentQuestion++;
    if (state.currentQuestion < state.quizData.length) {
        showQuestion();
    } else {
        showResults();
    }
}

// =================================================================
// HARD MODE & TIMER
// =================================================================
function insertHardModeRound() {
    const hardQuestions = shuffleArray(MASTER_HARD_MODE).slice(0, 3);
    state.quizData.splice(state.currentQuestion, 0, ...hardQuestions);
}

function showHardModal() {
    document.getElementById('hard-instructions').innerHTML =
        `<p class="small-note" style="text-align:center;">Get ready for a challenge!</p>
         <ul>
           <li><strong>${hardModeTimer}</strong> second timer per question.</li>
           <li><strong>Correct answers: +2 points</strong></li>
           <li><strong>Wrong answer or timeout: -1 point</strong></li>
         </ul>`;
    document.getElementById('hard-modal').classList.remove('hidden');
}

function startHardMode() {
    state.hardModeActive = true;
    document.getElementById('hard-modal').classList.add('hidden');
    showQuestion(); // Show the first hard question
}

function startHardTimer() {
    let timeLeft = hardModeTimer;
    const timerEl = document.getElementById('timer-display');
    timerEl.textContent = `Time Left: ${timeLeft}`;
    
    state.timerId = setInterval(() => {
        timeLeft--;
        timerEl.textContent = `Time Left: ${timeLeft}`;
        if (timeLeft <= 0) {
            handleHardTimeout();
        }
    }, 1000);
}

function handleHardTimeout() {
    clearTimer();
    state.score = Math.max(0, state.score - 1); // Penalty
    playSound('snd-wrong');

    // Show correct answer and disable options
    const q = state.quizData[state.currentQuestion];
    const btns = Array.from(document.querySelectorAll('#options button'));
    btns.forEach(b => {
        b.disabled = true;
        if (Number(b.dataset.orig) === q.correct) {
            b.classList.add('correct');
        }
    });
    
    document.getElementById('next').classList.remove('hidden');
}

function clearTimer() {
    if (state.timerId) {
        clearInterval(state.timerId);
        state.timerId = null;
    }
}

// =================================================================
// HINT FUNCTIONALITY
// =================================================================
function useHint() {
    if (state.hintUsed) return;
    const q = state.quizData[state.currentQuestion];
    const btns = Array.from(document.querySelectorAll('#options button'));
    
    const incorrectButtons = btns.filter(b => Number(b.dataset.orig) !== q.correct);
    
    if (incorrectButtons.length >= 2) {
        shuffleArray(incorrectButtons).slice(0, 2).forEach(b => {
            b.disabled = true;
            b.style.opacity = '0.4';
        });
        state.hintUsed = true;
        document.getElementById('hint').disabled = true;
    }
}

// =================================================================
// RESULTS & UI
// =================================================================
function showResults() {
    clearTimer();
    state.hardModeActive = false;
    document.getElementById('quiz-area').style.display = 'none';
    document.getElementById('results-area').style.display = 'block';

    const pct = Math.round((state.score / state.quizData.length) * 100);
    document.getElementById('score-area').innerHTML = `<h3>Your Score: ${state.score} (${pct}%)</h3>`;
    
    if (pct >= 90 && typeof confetti === 'function') {
        confetti({ particleCount: 150, spread: 80, origin: { y: 0.6 } });
    }

    const playerName = prompt("Enter your name for the leaderboard:", "Player") || "Player";

    const entry = { name: playerName, score: state.score };
    state.leaderboard.push(entry);
    state.leaderboard.sort((a, b) => b.score - a.score);
    if (state.leaderboard.length > 50) state.leaderboard.length = 50;
    localStorage.setItem('leaderboard', JSON.stringify(state.leaderboard));
    
    renderLeaderboard();

    const pos = state.leaderboard.findIndex(e => e.name === entry.name && e.score === entry.score) + 1;
    if (pos > 0) {
        const suffix = pos === 1 ? 'st' : pos === 2 ? 'nd' : pos === 3 ? 'rd' : 'th';
        document.getElementById('position-msg').textContent = `You placed ${pos}${suffix} on the leaderboard!`;
    }
}

function renderLeaderboard() {
    const area = document.getElementById('leaderboard-list');
    if (!state.leaderboard.length) {
        area.innerHTML = '<p class="small-note">No scores yet. Be the first!</p>';
    } else {
        area.innerHTML = state.leaderboard.slice(0, 5).map((x, i) => {
            const cls = i === 0 ? 'medal-gold' : i === 1 ? 'medal-silver' : i === 2 ? 'medal-bronze' : '';
            return `<div class="leaderboard-item ${cls}"><span>${i + 1}. ${x.name}</span><span>${x.score}</span></div>`;
        }).join('');
    }

    const resultsArea = document.getElementById('results-leaderboard');
    if (resultsArea) {
        resultsArea.innerHTML = '<h3>Full Leaderboard</h3><ol>' + state.leaderboard.map(x => `<li>${x.name} — ${x.score}</li>`).join('') + '</ol>';
    }
}

function openModal(title, content) {
    document.getElementById('generic-modal-title').textContent = title;
    document.getElementById('generic-content').innerHTML = content;
    document.getElementById('generic-modal').classList.remove('hidden');
}

function closeModal() {
    document.getElementById('generic-modal').classList.add('hidden');
}

function reviewAnswers() {
    const content = '<ol>' + state.userAnswers.map(a => {
        if (!a) return '';
        const chosenText = a.options[a.chosen] ?? 'Not Answered';
        const correctText = a.options[a.correct];
        let explanationHTML = a.explanation ? `<br><i class="small-note">${a.explanation}</i>` : '';
        return `<li><b>Q:</b> ${a.question}<br><b>Your Answer:</b> ${chosenText}<br><b>Correct:</b> ${correctText}${explanationHTML}</li>`;
    }).join('') + '</ol>';
    openModal('Review Answers', content);
}

// =================================================================
// HELPERS & EVENT LISTENERS
// =================================================================
function shuffleArray(a) { for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } return a; }
function playSound(id) { try { const sound = document.getElementById(id); sound.currentTime = 0; sound.play(); } catch (e) {} }
function updateProgressBar() { document.getElementById('progress-bar').style.width = `${(state.currentQuestion / state.quizData.length) * 100}%`; }

document.getElementById('start').addEventListener('click', () => {
    document.getElementById('welcome').style.display = 'none';
    document.getElementById('quiz-area').style.display = 'block';
    initializeQuiz();
});

document.getElementById('next').addEventListener('click', nextQuestion);
document.getElementById('hint').addEventListener('click', useHint);
document.getElementById('start-hard').addEventListener('click', startHardMode);
document.getElementById('close-generic').addEventListener('click', closeModal);

document.getElementById('quit').addEventListener('click', initializeQuiz);
document.getElementById('home').addEventListener('click', () => {
    document.getElementById('results-area').style.display = 'none';
    document.getElementById('welcome').style.display = 'block';
});

document.getElementById('review').addEventListener('click', reviewAnswers);

document.getElementById('settings').addEventListener('click', () => {
    const content = `<div class="small-note">Hard Mode Timer (seconds)</div>
                     <input id="hard-timer-input" type="number" min="5" max="60" value="${hardModeTimer}" />`;
    openModal('Settings', content);
});

document.getElementById('about').addEventListener('click', () => {
    const content = `<p class="small-note">This quiz teaches essential cybersecurity concepts through interactive questions. Test your knowledge and learn how to stay safe online!</p>`;
    openModal('About This Quiz', content);
});

// Special handling for closing settings to save the value
document.getElementById('close-generic').addEventListener('click', () => {
    const timerInput = document.getElementById('hard-timer-input');
    if (timerInput) {
        const v = Number(timerInput.value || hardModeTimer);
        hardModeTimer = Math.max(5, Math.min(60, v));
        localStorage.setItem('hardModeTimer', String(hardModeTimer));
    }
    closeModal();
});

// Initial load
renderLeaderboard();

</script>
</body>
</html>
