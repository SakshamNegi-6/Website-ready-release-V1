<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cyber Security Quiz</title>
  <meta name="description" content="An interactive and educational Cyber Security Quiz." />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Orbitron:wght@700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
  <style>
    /* Original CSS retained ‚Äî with minor fixes */
    body.minimal-bg #starfield-canvas { opacity: 0; transition: opacity 0.4s ease; }
    body.high-contrast { filter: contrast(1.4) brightness(1.2); }
    body.large-text { font-size: 1.2em; }
    body.reduce-motion * { transition: none !important; animation: none !important; }
    body.light-theme { background: #f9f9f9; color: #111; }
    .settings-row { display:flex;justify-content:space-between;align-items:center;margin:10px 0; }
    .switch{position:relative;display:inline-block;width:50px;height:28px;}
    .switch input{opacity:0;width:0;height:0;}
    .slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background:#333;transition:.4s;border-radius:28px;}
    .slider:before{position:absolute;content:"";height:20px;width:20px;left:4px;bottom:4px;background:#fff;transition:.4s;border-radius:50%;}
    input:checked+.slider{background:#41e0c3;}
    input:checked+.slider:before{transform:translateX(22px);}
  </style>
</head>
<body>
  <div id="background-wrapper"><canvas id="starfield-canvas"></canvas></div>
  <div class="screen-flash"></div>

  <!-- Splash -->
  <div id="splash-screen"><h1 id="splash-title">Cyber Security Quiz</h1></div>

  <!-- Welcome -->
  <div id="welcome-container" class="container">
    <div class="header"><div class="logo">CSQ</div><h1>Cyber Security Quiz</h1></div>
    <h2>A Fun Cyber Safety Challenge for Families</h2>
    <button id="start-btn" class="main-btn">Start Quiz</button>
    <div class="welcome-options">
      <button id="settings-btn">‚öôÔ∏è Settings</button>
      <button id="about-btn">‚ÑπÔ∏è About</button>
    </div>
    <div id="leaderboard-area" class="leaderboard"></div>
  </div>

  <!-- Quiz container -->
  <div id="quiz-container" class="container hidden">
    <div class="quiz-header">
      <span id="streak-counter"></span>
      <button id="hint-btn">üí° Hint</button>
    </div>
    <h3 id="round-title"></h3>
    <div id="progress-bar-container"><div id="progress-bar"></div></div>
    <div id="question-area">
      <p class="question" id="question"></p>
      <div class="options" id="options"></div>
      <div id="feedback-area" role="alert"></div>
    </div>
    <button id="next-btn" class="main-btn">Next</button>
  </div>

  <!-- Results -->
  <div id="results-container" class="container hidden">
    <div class="medal-display" id="medal-display"></div>
    <p class="final-badge" id="final-badge"></p>
    <div id="achievements-earned"></div>
    <div id="score-display-area"></div>
    <div id="high-score-area"></div>
    <div id="results-leaderboard-area" class="leaderboard"></div>
    <div id="save-score-area" class="hidden"></div>
    <div class="results-buttons">
      <button id="review-btn" class="main-btn">üîç Review Answers</button>
      <button id="go-home-btn" class="main-btn">üè† Go Home</button>
    </div>
    <div class="thank-you-message" id="thank-you-message"></div>
  </div>

  <!-- Settings Modal -->
  <div id="modal-overlay">
    <div id="modal-content" class="container">
      <h2>‚öôÔ∏è Settings</h2>
      <div class="settings-row"><label>Background Effects</label><label class="switch"><input type="checkbox" id="bg-toggle"><span class="slider"></span></label></div>
      <div class="settings-row"><label>High Contrast</label><label class="switch"><input type="checkbox" id="contrast-toggle"><span class="slider"></span></label></div>
      <div class="settings-row"><label>Large Text</label><label class="switch"><input type="checkbox" id="large-toggle"><span class="slider"></span></label></div>
      <div class="settings-row"><label>Reduce Motion</label><label class="switch"><input type="checkbox" id="motion-toggle"><span class="slider"></span></label></div>
      <div class="settings-row"><label>Theme</label><select id="theme-select"><option value="dark">Dark</option><option value="light">Light</option></select></div>
      <hr>
      <h3>Admin Controls</h3>
      <div class="settings-row"><button class="danger-btn" onclick="resetData('leaderboard')">Reset Leaderboard</button></div>
      <div class="settings-row"><button class="danger-btn" onclick="resetData('new-player')">Reset for New Player</button></div>
      <div class="settings-row"><button class="danger-btn" onclick="resetData('master')">Master Reset</button></div>
      <div class="modal-buttons"><button onclick="closeModal()" class="secondary-btn">Close</button></div>
    </div>
  </div>

  <script>
  /* ------------ QUIZ DATA ------------ */
  const MASTER_QUIZ_DATA = [
    { question:"A 'phishing' email is designed to...", options:["Trick you into revealing personal information","Sell you a product","Update your software","Entertain you"], answer:0 },
    { question:"What does 'HTTPS' at the start of a URL indicate?", options:["The website is popular","It is a high-speed site","The connection is secure and encrypted","The site is for commercial use"], answer:2 },
    { question:"Which of these is the strongest password?", options:["12345678","password123","R!v3r$1d3#24?","MyDogSparky"], answer:2 },
    { question:"What is the main risk of using public Wi-Fi?", options:["Slower internet speeds","Hackers can intercept your data","It uses more battery","You see more ads"], answer:1 },
    { question:"What should you do if you receive an unexpected email attachment?", options:["Open it immediately","Scan it with antivirus before opening","Forward it to friends","Ignore it always"], answer:1 },
    { question:"Which of the following is an example of two-factor authentication (2FA)?", options:["Entering a password only","Password + OTP sent to phone","Password + birthdate","Password + username"], answer:1 },
    { question:"A computer virus mainly...", options:["Physically damages the screen","Is malicious software that spreads","Increases computer speed","Improves internet"], answer:1 },
    { question:"Ransomware is a type of malware that...", options:["Asks for a ransom to restore your files","Deletes temporary files","Makes your computer faster","Updates your system"], answer:0 },
    { question:"Why should you update your software regularly?", options:["It looks better","To fix bugs and patch security holes","To get new wallpapers","Because it's fun"], answer:1 },
    { question:"What is a firewall?", options:["A security barrier that monitors traffic","A physical wall against fire","An antivirus program","A file storage system"], answer:0 },
    { question:"If a website asks for personal info and looks suspicious, you should...", options:["Give fake info","Check the URL and close it if unsafe","Enter real info quickly","Ignore the feeling"], answer:1 },
    { question:"Which one is a strong method of protecting your accounts?", options:["Reusing passwords","Using unique strong passwords + 2FA","Sharing passwords with friends","Writing passwords on sticky notes"], answer:1 },
    { question:"Social engineering is when attackers...", options:["Use code to hack","Trick people into giving info","Design new software","Create social media accounts"], answer:1 },
    { question:"What is 'shoulder surfing'?", options:["Watching someone type their password","Surfing the internet","Looking at social media","A phishing scam"], answer:0 },
    { question:"What should you do before clicking a link in an email?", options:["Hover over it to check the URL","Click it quickly","Forward it to others","Ignore it"], answer:0 },
    { question:"Which of these is NOT safe to share online?", options:["Your hobbies","Your full home address","Your favorite color","Your nickname"], answer:1 },
    { question:"What can help you remember multiple complex passwords securely?", options:["Using one password for all","Writing them on paper","Using a password manager","Telling a friend"], answer:2 },
    { question:"What does a VPN do?", options:["Connects you to public Wi-Fi","Protects and encrypts your connection","Makes internet slower","Deletes cookies"], answer:1 },
    { question:"Which of these devices can be hacked?", options:["Only computers","Only phones","Any device connected to the internet","None of them"], answer:2 },
    { question:"Why is it bad to reuse passwords?", options:["It‚Äôs boring","If one site is breached, all accounts become vulnerable","You forget them faster","It slows your PC"], answer:1 },
    { question:"A scam message asking for money urgently is an example of‚Ä¶", options:["Ransomware","Social engineering","Spam","Antivirus alert"], answer:1 },
    { question:"Which of these passwords is safest?", options:["Qwerty123","!Tiger@Sky_52$","Password1","123456"], answer:1 },
    { question:"What should you do after finishing work on a public computer?", options:["Leave it as is","Log out of all accounts","Install software","Turn off monitor only"], answer:1 },
    { question:"What‚Äôs a good rule for creating passwords?", options:["Use at least 12 characters, mix of letters/numbers/symbols","Use your pet‚Äôs name","Use 'password'","Use short easy words"], answer:0 },
    { question:"Which email sender is most suspicious?", options:["support@bank.com","bank.secure-alert@protonmail.com","noreply@apple.com","help@microsoft.com"], answer:1 },
    { question:"Which symbol in a web browser indicates encryption?", options:["üîí padlock","‚ùå cross","‚ö†Ô∏è triangle","üìß envelope"], answer:0 },
    { question:"What is malware?", options:["Any malicious software","A type of safe app","A backup system","A browser extension"], answer:0 },
    { question:"You get a text saying you‚Äôve won a prize. What should you do?", options:["Click link to claim","Ignore or delete it","Reply with address","Forward to everyone"], answer:1 },
    { question:"Why should you avoid downloading pirated software?", options:["It‚Äôs boring","It can contain malware","It uses extra RAM","It saves battery"], answer:1 },
    { question:"If your computer behaves strangely, first you should‚Ä¶", options:["Restart it","Run antivirus scan","Throw it away","Buy new device"], answer:1 },
    { question:"Which of these is NOT a good online habit?", options:["Using strong passwords","Checking URLs before clicking","Sharing every detail publicly","Keeping software updated"], answer:2 },
    { question:"When creating online accounts, always‚Ä¶", options:["Use your birthday","Use strong unique passwords","Use the same password","Skip 2FA"], answer:1 },
    { question:"An antivirus program helps you‚Ä¶", options:["Hack others","Protect from malicious software","Download games faster","Change themes"], answer:1 },
    { question:"What‚Äôs the best way to protect your smartphone?", options:["Keep it unlocked","Install updates and use screen lock","Share it with friends","Disable antivirus"], answer:1 },
    { question:"Which one is a form of identity theft?", options:["Someone using your photos","Someone pretending to be you to get info","Losing your charger","Sharing memes"], answer:1 },
    { question:"What‚Äôs the safest place to store your important files?", options:["Only on desktop","In a secure cloud backup","On a random website","Nowhere"], answer:1 },
    { question:"Why should you back up data?", options:["To recover if data is lost or stolen","To make files heavier","For decoration","No reason"], answer:0 },
    { question:"A fake website that looks like your bank‚Äôs is called‚Ä¶", options:["Mirror site","Phishing site","Safe backup","Redirect link"], answer:1 },
    { question:"Cookies in websites are used for‚Ä¶", options:["Tracking preferences & sessions","Making websites slower","Showing viruses","Encrypting data"], answer:0 },
    { question:"Which of these actions increases security?", options:["Using 2FA","Clicking unknown links","Sharing passwords","Using old software"], answer:0 },
    { question:"When a website asks for credit-card info, you should ensure‚Ä¶", options:["It uses HTTPS","It has lots of images","It loads quickly","It‚Äôs colorful"], answer:0 },
    { question:"You should NEVER share your OTP because‚Ä¶", options:["It changes daily","It grants access to your account","It‚Äôs long","It‚Äôs only for fun"], answer:1 },
    { question:"Which of these is phishing?", options:["An email pretending to be your bank","A legitimate site login","Downloading antivirus","Changing your password"], answer:0 },
    { question:"A good cyber-safety practice at school is‚Ä¶", options:["Sharing passwords","Locking your screen when away","Posting answers publicly","Leaving PC on"], answer:1 },
    { question:"Strong password example:", options:["Myname123","R@1nB0w$!25X","qwertyuiop","abc123"], answer:1 },
    { question:"Why should you verify friend requests?", options:["Fake profiles steal info","It gives you XP","It hides your posts","It doesn‚Äôt matter"], answer:0 },
    { question:"If a stranger online asks for your photo, you should‚Ä¶", options:["Send it","Ignore and block them","Ask for theirs first","Share publicly"], answer:1 },
    { question:"Which of these helps secure social-media accounts?", options:["Using privacy settings","Sharing passwords","Ignoring security alerts","Accepting all requests"], answer:0 },
    { question:"What should you do if your device is infected?", options:["Ignore it","Run antivirus and disconnect from network","Keep browsing","Delete random files"], answer:1 },
    { question:"A good habit when downloading apps:", options:["Download only from official stores","From any link","From unknown email","From pop-ups"], answer:0 },
    { question:"Cyber-bullying should be‚Ä¶", options:["Ignored","Reported to a trusted adult or authority","Encouraged","Revenge-replied"], answer:1 },
    { question:"What is encryption?", options:["Scrambling data so only authorized can read","Deleting data","Compressing files","Saving faster"], answer:0 },
    { question:"Which of the following best describes a strong PIN?", options:["1234","0000","9842","8452"], answer:3 },
    { question:"How often should you change important passwords?", options:["Never","Every few months","Daily","Once a year"], answer:1 },
    { question:"What‚Äôs a digital footprint?", options:["Trail of data you leave online","Your fingerprint","Foot icon","Nothing"], answer:0 },
    { question:"Why should you be careful on free-Wi-Fi?", options:["Hackers can intercept data","It‚Äôs too fast","It blocks videos","It‚Äôs private"], answer:0 },
    { question:"To protect personal info online‚Ä¶", options:["Share only necessary details","Post everything","Share passwords","Tag your location always"], answer:0 },
    { question:"Which one is safe to click?", options:["Bank alert from unknown link","Official site with HTTPS","Pop-up claiming reward","Unknown attachment"], answer:1 },
    { question:"Before installing an app, check‚Ä¶", options:["Permissions & reviews","Only its icon","Its color","Nothing"], answer:0 },
    { question:"What should you do if a friend‚Äôs account sends strange links?", options:["Click to see","Ignore & warn them","Share more","Like it"], answer:1 },
    { question:"Which of these practices improves security?", options:["Lock screen, update OS, use antivirus","Ignore updates","Disable password","Click random ads"], answer:0 },
    { question:"Why should you check sender‚Äôs address in emails?", options:["Scammers mimic real ones","It‚Äôs stylish","It‚Äôs long","It‚Äôs hidden"], answer:0 },
    { question:"Safe online behavior includes‚Ä¶", options:["Respecting others & protecting privacy","Sharing credentials","Mocking others","Posting private data"], answer:0 }
  ];
  const MASTER_HARD_MODE_1 = [
    { question:"What is a brute-force attack?", options:["Guessing every possible password combination","Installing random software","Sending spam emails","Hacking Wi-Fi"], answer:0 },
    { question:"What does 'SQL Injection' target?", options:["Databases through insecure queries","Antivirus software","CPU usage","RAM capacity"], answer:0 },
    { question:"A DDoS attack does what?", options:["Overloads a server with traffic","Deletes all files","Installs malware","Steals passwords directly"], answer:0 },
    { question:"What‚Äôs the purpose of hashing a password?", options:["Store it securely as non-reversible data","Encrypt temporarily","Hide it in RAM","Send it faster"], answer:0 },
    { question:"Which protocol uses port 443?", options:["HTTPS","HTTP","FTP","SMTP"], answer:0 },
    { question:"What‚Äôs an example of multi-factor authentication (MFA)?", options:["Password + Fingerprint","Username + Password","PIN + Password","Password + Birthday"], answer:0 },
    { question:"Which of the following is a common social-engineering technique?", options:["Pretexting","Port scanning","Ping flooding","Hashing"], answer:0 },
    { question:"What tool captures network packets?", options:["Wireshark","Visual Studio","VLC","Paint"], answer:0 },
    { question:"Which is the most secure encryption algorithm?", options:["AES-256","MD5","DES","ROT13"], answer:0 },
    { question:"The CIA triad stands for‚Ä¶", options:["Confidentiality, Integrity, Availability","Cyber, Internet, Access","Central Intelligence Agency","Control, Invest, Analyze"], answer:0 },
    { question:"Which malware logs keystrokes?", options:["Keylogger","Ransomware","Trojan","Spyware"], answer:0 },
    { question:"A 'zero-day exploit' means‚Ä¶", options:["An attack using an unknown vulnerability","A patch that fixes bugs","Outdated malware","Antivirus signature update"], answer:0 },
    { question:"Which layer of the OSI model handles encryption?", options:["Presentation","Application","Network","Session"], answer:0 },
    { question:"The main difference between symmetric and asymmetric encryption is‚Ä¶", options:["Number of keys used","Speed","Hardware used","File size"], answer:0 },
    { question:"The firewall‚Äôs job is to‚Ä¶", options:["Filter traffic based on rules","Increase bandwidth","Store data","Scan RAM"], answer:0 },
    { question:"Pharming vs Phishing ‚Äî pharming‚Ä¶", options:["Redirects users to fake sites without emails","Sends fake emails","Targets individuals","Is a type of spyware"], answer:0 },
    { question:"SSL/TLS certificates primarily ensure‚Ä¶", options:["Secure encrypted communication","Fast downloads","Free internet","User tracking"], answer:0 },
    { question:"A ‚Äòrootkit‚Äô does what?", options:["Hides malicious activity on a system","Improves boot speed","Backs up data","Runs antivirus"], answer:0 },
    { question:"Which command shows network interface configuration?", options:["ipconfig / ifconfig","netstat","ping","dir"], answer:0 },
    { question:"The principle of least privilege means‚Ä¶", options:["Give minimum necessary permissions","Give admin to everyone","Disable firewall","Allow all access"], answer:0 }
  ];

  const MASTER_HARD_MODE_2 = [
    { question:"What is XSS (Cross-Site Scripting)?", options:["Injecting malicious scripts into web pages","Crossing network signals","Hacking passwords","Encrypting websites"], answer:0 },
    { question:"What does 'ARP spoofing' do?", options:["Fakes MAC addresses to redirect traffic","Deletes routing tables","Encrypts files","Changes ports"], answer:0 },
    { question:"Which attack intercepts data between two parties?", options:["Man-in-the-Middle (MITM)","SQL Injection","Phishing","Spoofing"], answer:0 },
    { question:"What is the role of a honeypot?", options:["Attract hackers to study their methods","Host real data","Backup files","Encrypt servers"], answer:0 },
    { question:"Which command tests network connectivity?", options:["ping","tracert","netstat","telnet"], answer:0 },
    { question:"What is the primary goal of penetration testing?", options:["Find and fix vulnerabilities","Hack systems illegally","Delete logs","Install patches"], answer:0 },
    { question:"VPN tunnels primarily use which protocol?", options:["IPSec","FTP","SMTP","ICMP"], answer:0 },
    { question:"A hash collision means‚Ä¶", options:["Two inputs produce same hash","Different hash sizes","Corrupted files","No match found"], answer:0 },
    { question:"Which port does SMTP use?", options:["25","53","80","110"], answer:0 },
    { question:"What is the purpose of salting a hash?", options:["Add randomness to protect passwords","Speed up hashing","Compress data","Encrypt files"], answer:0 },
    { question:"Which is a common wireless security protocol?", options:["WPA2","FTP","SMTP","SNMP"], answer:0 },
    { question:"The main risk of default credentials is‚Ä¶", options:["Easy unauthorized access","Slow performance","High ping","Large files"], answer:0 },
    { question:"An IDS does what?", options:["Detects intrusions","Deletes malware","Encrypts files","Manages users"], answer:0 },
    { question:"What does a digital signature verify?", options:["Authenticity and integrity of data","Speed","Confidentiality","Compression"], answer:0 },
    { question:"Which is NOT a form of malware?", options:["Checksum","Trojan","Virus","Worm"], answer:0 },
    { question:"An attack vector is‚Ä¶", options:["A path used to exploit a system","A security tool","A firewall","An algorithm"], answer:0 },
    { question:"What is the primary purpose of hash functions in security?", options:["Verify integrity","Encrypt files","Compress data","Transfer packets"], answer:0 },
    { question:"DNS poisoning involves‚Ä¶", options:["Corrupting DNS cache to redirect traffic","Deleting records","Encrypting DNS","Changing MAC"], answer:0 },
    { question:"The term ‚Äòbotnet‚Äô means‚Ä¶", options:["A network of compromised computers","A secured network","LAN","Firewall system"], answer:0 },
    { question:"Which cyber-attack involves asking users for sensitive data via phone?", options:["Vishing","Phishing","Smishing","Baiting"], answer:0 }
  ];
  const ACHIEVEMENTS = [
    { id: "perfect", title: "Perfectionist", description: "Got every question right!", condition: (score, total) => score === total },
    { id: "fastThinker", title: "Fast Thinker", description: "Answered all questions quickly!", condition: (score, total, avgTime) => avgTime < 5 },
    { id: "persistent", title: "Persistent Player", description: "Played multiple times!", condition: (_, __, ___, playCount) => playCount >= 5 },
    { id: "cyberGuru", title: "Cyber Guru", description: "Achieved top score multiple times!", condition: (_, __, ___, ____, topCount) => topCount >= 3 }
  ];

  const roundTitles = ["Basic Cyber Awareness", "Intermediate Security", "Hardcore Hacker Mode"];
  let userAnswers = [];
  let timerInterval = null;
  let questionStartTime = 0;

  const state = {
    quizData: [],
    currentQuestion: 0,
    score: 0,
    startTime: 0,
    totalTime: 0,
    round: 0,
    playCount: parseInt(localStorage.getItem("playCount") || "0"),
    topCount: parseInt(localStorage.getItem("topCount") || "0"),
    highScore: parseInt(localStorage.getItem("cyberQuizHighScore") || "0")
  };

  function startQuiz() {
    // Pick 20 random normal questions
    const shuffled = MASTER_QUIZ_DATA.sort(() => Math.random() - 0.5);
    state.quizData = shuffled.slice(0, 20);
    state.currentQuestion = 0;
    state.score = 0;
    state.totalTime = 0;
    userAnswers = [];
    document.getElementById("welcome-container").classList.add("hidden");
    document.getElementById("quiz-container").classList.remove("hidden");
    document.getElementById("results-container").classList.add("hidden");
    loadQuestion();
  }

  function loadQuestion() {
    const q = state.quizData[state.currentQuestion];
    if (!q) { showResults(); return; }

    document.getElementById("question").textContent = q.question;
    const optContainer = document.getElementById("options");
    optContainer.innerHTML = "";

    q.options.forEach((opt, i) => {
      const btn = document.createElement("button");
      btn.textContent = opt;
      btn.className = "option-btn";
      btn.onclick = () => checkAnswer(i);
      optContainer.appendChild(btn);
    });

    document.getElementById("feedback-area").textContent = "";
    document.getElementById("next-btn").style.display = "none";
    questionStartTime = Date.now();
  }

  function checkAnswer(selectedIndex) {
    const q = state.quizData[state.currentQuestion];
    const timeTaken = (Date.now() - questionStartTime) / 1000;
    state.totalTime += timeTaken;
    userAnswers.push({ question: q.question, selected: selectedIndex, correct: q.answer });

    const feedback = document.getElementById("feedback-area");
    const buttons = document.querySelectorAll("#options button");

    buttons.forEach((b, i) => {
      b.disabled = true;
      if (i === q.answer) b.classList.add("correct");
      if (i === selectedIndex && i !== q.answer) b.classList.add("wrong");
    });

    if (selectedIndex === q.answer) {
      feedback.textContent = "‚úÖ Correct!";
      state.score++;
    } else {
      feedback.textContent = `‚ùå Wrong! Correct answer: ${q.options[q.answer]}`;
    }

    document.getElementById("next-btn").style.display = "inline-block";
  }

  document.getElementById("next-btn").onclick = function () {
    state.currentQuestion++;
    if (state.currentQuestion < state.quizData.length) {
      loadQuestion();
    } else {
      showResults();
    }
  };

  function showResults() {
    document.getElementById("quiz-container").classList.add("hidden");
    document.getElementById("results-container").classList.remove("hidden");

    const total = state.quizData.length;
    const avgTime = total > 0 ? (state.totalTime / total).toFixed(1) : 0;
    document.getElementById("score-display-area").innerHTML = `
      <h2>Score: ${state.score} / ${total}</h2>
      <p>Average time per question: ${avgTime}s</p>
    `;

    state.playCount++;
    localStorage.setItem("playCount", state.playCount);
    updateAchievements(avgTime);
    updateHighScore();
  }

  function updateAchievements(avgTime) {
    const achieved = [];
    ACHIEVEMENTS.forEach(a => {
      if (a.condition(state.score, state.quizData.length, avgTime, state.playCount, state.topCount)) achieved.push(a);
    });

    const area = document.getElementById("achievements-earned");
    if (achieved.length > 0) {
      area.innerHTML = "<h3>üéñÔ∏è Achievements Unlocked:</h3>" + achieved.map(a => `<p>${a.title} - ${a.description}</p>`).join("");
    } else {
      area.innerHTML = "<p>No new achievements this time.</p>";
    }
  }

  function updateHighScore() {
    const prevHigh = parseInt(localStorage.getItem("cyberQuizHighScore") || "0");
    if (state.score > prevHigh) {
      localStorage.setItem("cyberQuizHighScore", state.score);
      localStorage.setItem("topCount", state.topCount + 1);
      document.getElementById("high-score-area").innerHTML = `<p>ü•á New High Score: ${state.score}</p>`;
    } else {
      document.getElementById("high-score-area").innerHTML = `<p>High Score: ${prevHigh}</p>`;
    }
  }
  /* -------- REVIEW SYSTEM -------- */
  function showReview() {
    const reviewDiv = document.createElement("div");
    reviewDiv.innerHTML = "<h3>Answer Review</h3>";
    userAnswers.forEach((ans, i) => {
      const qDiv = document.createElement("div");
      qDiv.innerHTML = `<strong>Q${i + 1}:</strong> ${ans.question}<br>
        You answered: <span style="color:${ans.selected === ans.correct ? 'green' : 'red'}">
        ${state.quizData[i].options[ans.selected] || "No answer"}</span><br>
        Correct: <span style="color:green">${state.quizData[i].options[ans.correct]}</span>`;
      reviewDiv.appendChild(qDiv);
    });
    document.getElementById("results-container").appendChild(reviewDiv);
  }

  document.getElementById("review-btn").onclick = showReview;
  document.getElementById("go-home-btn").onclick = () => {
    document.getElementById("results-container").classList.add("hidden");
    document.getElementById("welcome-container").classList.remove("hidden");
  };

  /* -------- LEADERBOARD -------- */
  function saveScoreToLeaderboard(name) {
    const lb = JSON.parse(localStorage.getItem("leaderboard") || "[]");
    lb.push({ name, score: state.score, date: new Date().toISOString() });
    lb.sort((a, b) => b.score - a.score);
    if (lb.length > 10) lb.length = 10;
    localStorage.setItem("leaderboard", JSON.stringify(lb));
    renderLeaderboard();
  }

  function renderLeaderboard() {
    const lb = JSON.parse(localStorage.getItem("leaderboard") || "[]");
    const area = document.getElementById("leaderboard-area");
    if (!lb.length) {
      area.innerHTML = "<p>No scores yet.</p>";
      return;
    }
    area.innerHTML = "<h3>üèÜ Top Players</h3>" +
      lb.map((e, i) => `<p>${i + 1}. ${e.name} ‚Äî ${e.score}</p>`).join("");
  }

  renderLeaderboard();

  /* -------- SETTINGS -------- */
  const settings = {
    background: localStorage.getItem("setting_background") === "true",
    contrast: localStorage.getItem("setting_contrast") === "true",
    largeText: localStorage.getItem("setting_largeText") === "true",
    reduceMotion: localStorage.getItem("setting_reduceMotion") === "true",
    theme: localStorage.getItem("setting_theme") || "dark"
  };

  function applySettings() {
    document.body.classList.toggle("minimal-bg", !settings.background);
    document.body.classList.toggle("high-contrast", settings.contrast);
    document.body.classList.toggle("large-text", settings.largeText);
    document.body.classList.toggle("reduce-motion", settings.reduceMotion);
    document.body.classList.toggle("light-theme", settings.theme === "light");

    document.getElementById("bg-toggle").checked = settings.background;
    document.getElementById("contrast-toggle").checked = settings.contrast;
    document.getElementById("large-toggle").checked = settings.largeText;
    document.getElementById("motion-toggle").checked = settings.reduceMotion;
    document.getElementById("theme-select").value = settings.theme;
  }

  function updateSetting(key, value) {
    settings[key] = value;
    localStorage.setItem(`setting_${key}`, value);
    applySettings();
  }

  document.getElementById("bg-toggle").onchange = e => updateSetting("background", e.target.checked);
  document.getElementById("contrast-toggle").onchange = e => updateSetting("contrast", e.target.checked);
  document.getElementById("large-toggle").onchange = e => updateSetting("largeText", e.target.checked);
  document.getElementById("motion-toggle").onchange = e => updateSetting("reduceMotion", e.target.checked);
  document.getElementById("theme-select").onchange = e => updateSetting("theme", e.target.value);

  /* -------- ADMIN RESET (with /api/check-password.js) -------- */
  async function resetData(type) {
    const pass = prompt("Enter admin password:");
    if (!pass) return alert("Cancelled.");

    try {
      const res = await fetch("/api/check-password", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ password: pass })
      });
      const data = await res.json();
      if (!data.success) return alert("‚ùå Invalid password!");

      if (type === "leaderboard") localStorage.removeItem("leaderboard");
      if (type === "new-player") {
        localStorage.removeItem("playCount");
        localStorage.removeItem("cyberQuizHighScore");
      }
      if (type === "master") {
        localStorage.clear();
      }

      alert(`‚úÖ ${type.replace("-", " ").toUpperCase()} reset successful.`);
      renderLeaderboard();
    } catch (err) {
      alert("Error connecting to server.");
      console.error(err);
    }
  }

  /* -------- MODAL CONTROL -------- */
  function openModal() {
    document.getElementById("modal-overlay").style.display = "block";
    applySettings();
  }

  function closeModal() {
    document.getElementById("modal-overlay").style.display = "none";
  }

  document.getElementById("settings-btn").onclick = openModal;
  document.addEventListener("DOMContentLoaded", () => {
    renderLeaderboard();
    applySettings();
  });

  /* -------- STARFIELD BACKGROUND -------- */
  const canvas = document.getElementById("starfield-canvas");
  const ctx = canvas.getContext("2d");
  let stars = [];

  function resizeCanvas() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    generateStars();
  }

  function generateStars() {
    const count = 100;
    stars = [];
    for (let i = 0; i < count; i++) {
      stars.push({
        x: Math.random() * canvas.width,
        y: Math.random() * canvas.height,
        radius: Math.random() * 1.5,
        speed: 0.1 + Math.random() * 0.3
      });
    }
  }

  function animateStars() {
    if (document.body.classList.contains("minimal-bg")) {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      return requestAnimationFrame(animateStars);
    }
    ctx.fillStyle = "rgba(0,0,0,0.3)";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = "#fff";

    stars.forEach(s => {
      s.y += s.speed;
      if (s.y > canvas.height) s.y = 0;
      ctx.beginPath();
      ctx.arc(s.x, s.y, s.radius, 0, Math.PI * 2);
      ctx.fill();
    });

    requestAnimationFrame(animateStars);
  }

  window.addEventListener("resize", resizeCanvas);
  resizeCanvas();
  animateStars();
  </script>
</body>
</html>
